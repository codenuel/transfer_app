doctype html
html
    head
        title Rave Transfer
        link(rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.css")
        link(rel="stylesheet" href="./stylesheets/style.css")
        link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css")
        link(rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous")
        

        
    body
        nav.navbar.navbar-expand-lg.navbar-light.bg-dark
            .container
                a.navbar-brand(href='/') Transfers
                button.navbar-toggler(type='button', data-toggle='collapse', data-target='#navbarNav', aria-controls='navbarNav', aria-expanded='false', aria-label='Toggle navigation')
                    span.navbar-toggler-icon
                #navbarNav.collapse.navbar-collapse
                    //- ul.navbar-nav
                    //- li.nav-item
                    //- a.nav-link(href='/') Transfer 
                    //- span.sr-only (current)
        
        block content
        
        hr
        footer 
            p copyright &copy; 2019
    

        script(src='https://code.jquery.com/jquery-3.3.1.slim.min.js', integrity='sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo', crossorigin='anonymous')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js', integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49', crossorigin='anonymous')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js', integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy', crossorigin='anonymous')
        
        script.

            $(document).ready(function(){
                $("#btn-continue").click(function(){
                    var amount = $("#amount").val();
                    var sender_email = $("#rsender-email").val();
                    var recipient_bank = $("#recipient-bank").val();
                    var recipient_account = $("#recipient-account").val();
                    var message = $("#message-text").val();

                    //- $.post("/account-verify",
                    //- {
                    //-     recipient_bank: "recipient-bank",
                    //-     recipient_account: "recipient-account"
                    //- },
                    //- function(data, status){
                    //-     alert("Data: " + data + "\nStatus: " + status);
                    //- });

                    $.ajax({
                        url: '/account-verify',
                        xhrFields: {
                            withCredentials: true
                        },
                        headers: {
                        
                        },
                        type: 'post',
                        data: {
                            recipient_bank: bank_name,
                            recipient_account: account_number
                           
                        },
                        dataType: 'json',
                        success: function (resp) {
                            console.log(resp);
                            var transferResp = resp;
                            var errors = false;

                            if(!recipient_bank || !recipient_account) {
                                errors = true
                            }

                            if(errors){
                            alert('Please complete the form');
                            }else{
                            getpaidSetup(
                                {
                                    amount: amount,
                                    sender_email: sender_email,
                                    recipient_bank: bank_name,
                                    recipient_account: account_number,
                                    country: "NG",
                                    currency: "NGN",
                                    custom_logo: '',
                                    custom_description: transferResp.description,
                                    custom_title: 'Ventillum Limited',
                                    payment_method: "both",
                                    txref: transferResp.reference,
                                    PBFPubKey: api_key,
                                    integrity_hash: "", //integrity hash is gotten from the checksum integrity hash implementation
                                    onclose:function(response) {
                                        window.location = '/payments/verify?ref=' + transferResp.reference;
                                    },
                                    callback:function(response) { //console.log(response.tx)
                                    window.location = '/payments/verify?ref=' + transferResp.reference;
                                    }
                                }
                            );
                            }
                        },
                        error: function(err){
                            console.log(err);
                            alert(err.toString());
                        }
                    });
                });
            });

           