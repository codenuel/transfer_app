doctype html
html
    head
        title Rave Transfer
        link(rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.css")
        link(rel="stylesheet" href="./stylesheets/style.css")
        link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css")
        link(rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css")
        

        
    body
        nav.navbar.navbar-expand-lg.navbar-light.bg-dark
            .container
                a.navbar-brand(href='/') Transfers
                button.navbar-toggler(type='button', data-toggle='collapse', data-target='#navbarNav', aria-controls='navbarNav', aria-expanded='false', aria-label='Toggle navigation')
                    span.navbar-toggler-icon
                #navbarNav.collapse.navbar-collapse
                    //- ul.navbar-nav
                    //- li.nav-item
                    //- a.nav-link(href='/') Transfer 
                    //- span.sr-only (current)
        
        block content
        
        hr
        footer 
            p copyright &copy; 2019
    
        script(src="https://code.jquery.com/jquery-3.1.1.min.js")
        script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js')
        script(src="https://ravesandboxapi.flutterwave.com/flwv3-pug/getpaidx/api/flwpbf-inline.js" type="text/javascript")
        
        script.
            
            $(document).ready(function(){

                $("#recipient-account").keyup(function() {
                    var recipient_bank = $("#recipient-bank").val();
                    var recipient_account = $("#recipient-account").val();

                    if(recipient_account.length === 10){
                        $.ajax({
                            url: '/account-verify',
                            type: 'post',
                            data: {
                                
                                recipient_bank: recipient_bank,
                                recipient_account: recipient_account
                            },
                            dataType: 'json',
                            success: function (resp) {
                                console.log(resp);
                            },
                            error: function(err){
                                console.log(err);
                                //- alert(err.toString());
                            }
                        });
                        
                    }
                });
                
                $("#btn-continue").click(function(){

                    var amount = $("#amount").val();
                    var sender_email = $("#rsender-email").val();
                    var recipient_bank = $("#recipient-bank").val();
                    var recipient_account = $("#recipient-account").val();
                    var description = $("#description").val();
                    var reference = $("#txRef").val();

                    //- var transferResp = resp;
                    var errors = false;

                    if(!amount || !sender_email || !recipient_bank || !recipient_account) {
                        errors = true
                    }

                    if(errors){
                    alert('Please complete the form');
                    }else{
                        $("button.close").click()
                        getpaidSetup(
                            {
                                customer_email: sender_email,
                                customer_firstname: '',
                                customer_lastname: '',
                                customer_phone: '',
                                amount: amount,
                                country: "NG",
                                currency: "NGN",
                                custom_logo: '',
                                custom_description: description,
                                custom_title: 'Newlife Enterprise',
                                payment_method: "both",
                                txref: reference,
                                PBFPubKey: "FLWPUBK-a5715a67d24e61ce3e7bf79ae22ef524-X",
                                integrity_hash: "", //integrity hash is gotten from the checksum integrity hash implementation
                                onclose:function(response) {
                                    window.location = '/verify-transaction?ref=' + ref;
                                },
                                callback:function(response) { //console.log(response.tx)
                                    window.location = '/verify-transaction?ref=' + ref;
                                }
                            } 
                        );
                    }
                });

             });
        

           